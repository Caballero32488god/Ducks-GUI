local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ScreenGui = Instance.new("ScreenGui")
local ToggleButton = Instance.new("TextButton")

-- Global variable for teleportation state
_G.teleportPlayersActive = false

-- Create the toggle button
ToggleButton.Size = UDim2.new(0, 150, 0, 50)
ToggleButton.Position = UDim2.new(0.5, -75, 0.5, -25)
ToggleButton.Text = "Start Teleporting"
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Parent = ScreenGui

ScreenGui.Parent = game.CoreGui

-- Function to create and display notification
local function showNotification(message)
    local Notification = Instance.new("TextLabel")
    Notification.Text = message
    Notification.Size = UDim2.new(0.3, 0, 0.1, 0)
    Notification.Position = UDim2.new(0.5, -75, 0.1, 0)
    Notification.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Notification.TextColor3 = Color3.fromRGB(255, 255, 255)
    Notification.TextScaled = true
    Notification.Parent = ScreenGui

    -- Fade out effect
    for i = 1, 10 do
        wait(0.1)
        Notification.TextTransparency = i / 10
    end

    Notification:Destroy()
end

-- Function to teleport players and remove their arms and hands
local function teleportAndRemoveLimbs(otherCharacter, targetPosition)
    if otherCharacter then
        -- Teleport the entire character to the local player's position
        otherCharacter:SetPrimaryPartCFrame(CFrame.new(targetPosition))

        -- Remove arms and hands
        local leftArm = otherCharacter:FindFirstChild("Left Arm")
        local rightArm = otherCharacter:FindFirstChild("Right Arm")
        local leftHand = otherCharacter:FindFirstChild("LeftHand")
        local rightHand = otherCharacter:FindFirstChild("RightHand")

        if leftArm then leftArm:Destroy() end
        if rightArm then rightArm:Destroy() end
        if leftHand then leftHand:Destroy() end
        if rightHand then rightHand:Destroy() end
    end
end

-- Function to continuously teleport players
local function teleportPlayers()
    local targetPosition = LocalPlayer.Character.HumanoidRootPart.Position -- Store the local player's position

    while _G.teleportPlayersActive do
        for _, otherPlayer in pairs(Players:GetPlayers()) do
            if otherPlayer ~= LocalPlayer then
                local otherCharacter = otherPlayer.Character
                if otherCharacter then
                    teleportAndRemoveLimbs(otherCharacter, targetPosition)
                end
            end
        end
        wait(0.01) -- Very fast teleportation loop
    end
end

-- Function to handle player respawn
local function onCharacterAdded(character)
    while _G.teleportPlayersActive do
        teleportAndRemoveLimbs(character, LocalPlayer.Character.HumanoidRootPart.Position)
        wait(0.01) -- Fast loop for respawns
    end
end

-- Start action
local function startTeleporting()
    _G.teleportPlayersActive = true
    teleportPlayers()
end

-- Toggle action on button click
ToggleButton.MouseButton1Click:Connect(function()
    if not _G.teleportPlayersActive then
        showNotification("Teleporting Players and Removing Limbs!")
        startTeleporting()
        ToggleButton.Text = "Stop Teleporting"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    else
        _G.teleportPlayersActive = false
        showNotification("Stopped Teleporting.")
        ToggleButton.Text = "Start Teleporting"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    end
end)

-- Connect to CharacterAdded for the local player
LocalPlayer.CharacterAdded:Connect(function(character)
    if _G.teleportPlayersActive then
        character:WaitForChild("HumanoidRootPart")
        onCharacterAdded(character)
    end
end)

-- Initially hide the button
ToggleButton.Visible = true
